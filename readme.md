Another huge part of code